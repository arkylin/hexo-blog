---
title: 阿里云云函数配置百度自动推送
categories:
  - [阿里云]
tags:
  - [阿里云]
date: 2020-07-06 21:57:28
translate_title: Alibaba-Cloud-Cloud-function-configuration-Baidu-automatic-push
keywords: 自动推送,百度
description: 实现浏览文章时自动推送链接到百度
top_img: baidu_push.png
comments:
cover: baidu_push.png
toc:
toc_number:
copyright:
mathjax:
katex:
hide:
top:
---
实现浏览文章时自动推送链接到百度

如图
<img src="baidu_push.png" width="100%" alt="baidu_push">

```Python index.py
import requests
import re
import json
from flask import Flask, request

app = Flask(__name__)

@app.route('/baidu-push', methods=['GET'])
def baidu_push():
    data = str(request.referrer)
    #data = 'https://www.xyz.blue/'
    if data != "":
      if re.match(r'https://.*domain.name.*', data): #防滥用域名推送限制
        url = "http://data.zz.baidu.com/urls?site=https://domain.name&token=your_token"
        headers = {
          'User-Agent': 'curl/7.12.1',
          'Host': 'data.zz.baidu.com',
          'Content-Type': 'text/plain',
          'Content-Length': '83'
        }
        res = requests.post(url, headers=headers, data=data).text
        text = json.loads(res)
        if text['success'] == 1:
          return "{'Res': 'Success'" + "," + "'Remain':" + " " + str(text['remain']) + "}"
        else:
          return "{'Res': 'Fail'}"
      else:
        return "{'Res': 'Not_Same_Site'}"
    else:
      return "{'Res': 'None'}"

if __name__ == '__main__':
    app.run()
```
函数配置
```Yaml template.yml
ROSTemplateFormatVersion: '2015-09-01'
Transform: 'Aliyun::Serverless-2018-04-03'
Resources:
  Blog:
    Type: 'Aliyun::Serverless::Service'
    Properties:
      Role: 'acs:ram::ID:role/AliyunFCLogExecutionRole'
      LogConfig:
        Project: aliyun-fc-ap-southeast-1-ID
        Logstore: function-log
      InternetAccess: true
    baidu-push:
      Type: 'Aliyun::Serverless::Function'
      Properties:
        Handler: index.app
        Runtime: python3
        Timeout: 5
        MemorySize: 128
        CodeUri: Blog\baidu-push
      Events:
        baidu-push:
          Type: HTTP
          Properties:
            AuthType: ANONYMOUS
            Methods:
              - GET
```
Hexo-Butterfly配置
在`layout-include-head.pug`的适当地方插入以实现自动加载
```Js Example
<script type="text/javascript" defer="" src="https://api.domain.name/baidu-push"></script>
```

最后发现其实可以直接用百度提供的额🤣🤣🤣 👀
```Js Example
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
```